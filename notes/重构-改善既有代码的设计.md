## 重构的基本原则

### 关于重构的定义

重构：在不改变软件可观测行为的情况下优化代码的内部结构使得其易于理解，易于修改

### two hats

添加新功能 vs 重构

添加新功能时不改变现有代码的内部结构，仅添加新功能，添加针对新功能的测试代码。重构时仅优化代码内部结构（使得添加新功能更为容易且代码更易于理解）。正常情况下，重构不应该添加任何测试代码。一旦觉得添加新功能或者测试难以进行时就需要进行重构。

### 为什么需要重构？

- 重构可以改善既有代码的设计
  由于各种各样的原因，人们处于短期目标对代码库做出的修改很可能是不符合代码整体架构的，比如说同样的功能在公用模块中已经实现了，但是你没看到或者公用模块里的实现不满足你的定制需求，于是为了解决问题你直接把公用模块的实现复制到私有模块中加以修改。而重复代码会给后期维护带来很大的问题。
- 重构使得软件易于理解
  通常情况下我们在实现一个功能的时候可能不会考虑可读性，我们只关注代码能不能正常执行，功能是否正常实现。通过重构我们有机会优化代码的内部结构，使得代码能更好的表达我们的意图，更容易被别人所理解。
- 重构能帮助我们发现 bug
  重构能帮助我们理解代码，弄清楚代码的结构，随着代码结构愈加清晰，bug 会愈加无所遁形
- 重构使得添加新功能变得容易
  糟糕的代码使得添加新功能变得困难且容易引入 bug，设计糟糕的代码会随着时间的发展变得越来越难以维护。

### Preparatory Refactoring-Making It Easier to Add a Feature

进行重构的最好时机是在你准备添加新功能或者修复 bug 之前。比如说在你添加新功能之前现有代码库中已经有类似功能的函数，只不过需要做些改动，偷懒的方式就是直接复制现有代码，然后加以改动，但是这样就为代码库引入了重复代码（日后需要修改的时候就需要同时修改两个地方，这显然是不可接受的）。

### Comprehension Refactoring-Making Code Easier to Understand

修改代码之前需要先理解代码，对于那些需要花费精力才能弄明白的代码可以考虑下能否通过重构使得理解代码意图更为容易，这样别人在看代码的时候也会更为容易。

### 重构带来的问题

- 降低添加新功能的速度

## 代码的坏味道

- mysterious name
  好的名字能让人快速了解代码所表达的意图，糟糕的明命名让人不明所以

- duplicated code
  重复代码使得后续修改变得困难

- long function
- long parameter list
- global data
- mutable data
